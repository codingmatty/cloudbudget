{"version":3,"sources":["../../src/db/account.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAKA,IAAM,aAAa,GAAG,cAHH,MAAM,CAGQ;AAC/B,MAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;AACtC,OAAK,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;AACvC,MAAI,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC,SAAS,EAAE,UAAU,EAAE,aAAa,EAAE,MAAM,EAAE,YAAY,CAAC,EAAE,QAAQ,EAAE,IAAI,EAAE;AAC1G,QAAM,EAAE,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,IAAI,EAAE;AACzC,OAAK,EAAE,MAAM;AACb,MAAI,EAAE,EAAE,IAAI,EAAE,UATG,MAAM,CASF,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,MAAM,EAAE,QAAQ,EAAE,IAAI,EAAE;AAClE,cAAY,EAAE,CAAC,EAAE,IAAI,EAAE,UAVN,MAAM,CAUO,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,aAAa,EAAE,CAAC;CACpE,EAAE;AACD,QAAM,EAAE,OAXD,kBAAkB,EAWE,UAAC,GAAG,EAAE,GAAG,EAAK;AACvC,OAAG,CAAC,YAAY,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAA,WAAW;aAAI,WAAW,YAAY,UAbvD,KAAK,CAawD,QAAQ,GAAG,WAAW,CAAC,QAAQ,EAAE,GAAG,WAAW;KAAA,CAAC,CAAC;GACtI,CAAC;CACH,CAAC,CAAC;;AAEH,aAAa,CAAC,MAAM,CAAC,eAAe,EAAE,YAAM;AAC1C,SAAO,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;CACjC,CAAC,CAAC;;AAEH,aAAa,CAAC,OAAO,CAAC,UAAU,GAAG,SAAS,UAAU,CAAC,IAAI,EAAE;AAC3D,MAAM,OAAO,GAAG,IAAI,CAAC;AACrB,KAtB2B,WAAW,CAsB1B,IAAI,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,EAAE,EAAE,EAAE,UAAC,GAAG,EAAE,YAAY,EAAK;AAC/D,QAAI,GAAG,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;AAC1B,QAAI,CAAC,IAAI,EAAE,iBAAE,GAAG,CAAC,YAAY,EAAE,QAAQ,CAAC,CAAC,CAAC;GAC3C,CAAC,CAAC;CACJ,CAAC;;AAEF,IAAM,OAAO,GAAG,mBAAS,KAAK,CAAC,SAAS,EAAE,aAAa,CAAC,CAAC;;AAEzD,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAC,OAAO,EAAE,IAAI,EAAK;;AAE/C,KAhC2B,WAAW,CAgC1B,IAAI,CAAC,EAAE,OAAO,EAAE,OAAO,CAAC,EAAE,EAAE,EAAE,UAAC,GAAG,EAAE,YAAY,EAAK;AAC/D,QAAI,GAAG,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;AAC1B,oBAAM,IAAI,CAAC,YAAY,EAAE,UAAC,WAAW,EAAE,IAAI,EAAK;AAC9C,iBAAW,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;KAC1B,EAAE,IAAI,CAAC,CAAC;GACV,CAAC,CAAC;CACJ,CAAC,CAAC;;kBAEY,OAAO","file":"account.js","sourcesContent":["import _ from 'lodash';\nimport async from 'async';\nimport mongoose, { Schema, Types } from 'mongoose';\nimport { defaultJSONOptions, Transaction } from './';\n\nconst accountSchema = new Schema({\n  name: { type: String, required: true },\n  group: { type: String, required: true },\n  type: { type: String, enum: ['savings', 'checking', 'credit_card', 'loan', 'investment'], required: true },\n  budget: { type: Boolean, required: true },\n  notes: String,\n  user: { type: Schema.Types.ObjectId, ref: 'User', required: true },\n  transactions: [{ type: Schema.Types.ObjectId, ref: 'Transaction' }]\n}, {\n  toJSON: defaultJSONOptions((doc, ret) => {\n    ret.transactions = ret.transactions.map(transaction => transaction instanceof Types.ObjectId ? transaction.toString() : transaction);\n  })\n});\n\naccountSchema.static('readonlyProps', () => {\n  return ['transactions', 'user'];\n});\n\naccountSchema.methods.getBalance = function getBalance(done) {\n  const account = this;\n  Transaction.find({ account: account.id }, (err, transactions) => {\n    if (err) return done(err);\n    done(null, _.sum(transactions, 'amount'));\n  });\n};\n\nconst Account = mongoose.model('Account', accountSchema);\n\nAccount.schema.post('remove', (account, next) => {\n  // Remove all transactions that are apart of this account\n  Transaction.find({ account: account.id }, (err, transactions) => {\n    if (err) return next(err);\n    async.each(transactions, (transaction, done) => {\n      transaction.remove(done);\n    }, next);\n  });\n});\n\nexport default Account;\n"]}